## reg
### add
`reg add <Registry Key> /v <Value> /t <Type> /d <Data> /f`<br>
- `reg`：レジストリ操作コマンド<br>
- `add <レジストリーキー>`：存在しなければ追加、存在した場合は変更内容が更新される。パスの最後に`\`は不要。<br>
- `/v <項目の値名>`：『Value』の"v"。<br>
- `/t <項目の種類>`：『Type』の"t"。<br>
- `/d <項目の値>`：『data』の"d"。<br>
- `/f`：ユーザーへの確認を行わずに強制的に処理する。『force』の"f"。<br>
<br>

> [!Note]
> - 基本的には管理者権限が必要
> - 各項目の値や数値を指定する際、必ずしも値を`"`で囲む必要はないが、<br>値にスペースが含まれる場合に正しく動作しない可能性があるため、`"`はつけた方がよい。

### query
`reg query <Registry Key> <Option>`<br>
<br>

## if
`if <条件> <コマンド> else <条件> <コマンド>`　or　`if <条件> (<コマンド>) else <条件> (<コマンド>)`<br>

複数行に分けて書くことも可能
```cmd
if <条件> (
  <コマンド>
) else (
  <コマンド>
)
```

### errorlevel
`if %errorlevel%==0 <コマンド>`<br>
直前に実行したコマンドのエラーレベルを条件にコマンドが実行される。<br>
実行されたコマンドが正常に終了すれば０、正常に終了しなければ１以上を返します。<br>
返された値は「%errorlevel%」特別な変数に格納されます。<br>

### exist
`if exist <ファイル名> <コマンド>`<br>
指定したファイルが存在する場合にコマンドが実行される。<br>

### defined
`if defined <変数名> <コマンド>`<br>
指定した変数が定義されている場合にコマンドが実行される。<br>
<br>

## 変数
`set <変数名>=[変数へ格納したい値, 文字列]`
- `=`の前後には空白を入れるとエラーが発生する
- 他言語では、文字列であることを識別するために`"`で囲う必要があるが、cmdでは基本的には必要ない（一部コマンドでは必要な場合がある）
- スペースが含まれる値であっても代入してくれる

変数を使用する場合は、変数を`%`で囲む必要がある
```cmd
set STR=Hello
echo %STR%
```

### 環境変数
`set`コマンドで一覧が表示される<br>
<br>

## @echo off
コマンドラインを見やすくするためのコマンド。<br>
このコマンドを実行すると`<C:\Users\<User>\...>`の部分を非表示にし、コメントアウトされた行も非表示にする<br>
再度表示させるには`@echo on`を実行すると表示されるようになる<br>
<br>

## コメントアウト
`REM`コマンドを使用するか、先頭に`::`をつけるとコメント化できる。<br>
それぞれ異なるスタイルではあるものの、２つとも行全体をコメント化できることに変わりはなく、<br>
どちらを使っても問題ない。<br>
<br>

## 管理者権限で実行しているかどうかの判定
管理者権限がないと実行ができないコマンドを利用した判定方法が一般的に使われており、その中で一般的によく使われているのが「OpenFiles」や「Net Session」を利用したもの。<br>
```cmd
openfiles > nul 2>&1
if %errorlevel% neq 0 (
  echo 管理者権限がありません。
  pause
)
```
`2>&1`は、「エラー出力」を「標準出力」にリダイレクトする記述。<br>
「2」は標準エラー出力を表しており、「1」は標準出力を表している。<br>
「&」はリダイレクトを複数組み合わせる場合に必要な記号。<br>
<br>

## 文字化け
`echo`を使用して日本語を出力するとき、プロンプト上で文字化けすることがある<br>
その場合は、`chcp`コマンドで文字コードを指定すると解決する<br>
もしくはコマンドプロンプトの文字コードが「Shift_JIS」であることに限り、文字コードを「ANSI」でエンコードすることでも解決するが、互換性がない文字コード間では現象が起きるため、根本的な解決にはなっていない<br>

<details>
<summary>chcpコマンド</summary>
  
構文：`chcp <コードページ番号>`
  
|コードページ番号|文字コード|
:-:|:-:
|932|shift-jis|
|1200|utf-16|
|51932|ecu-jp|
|65000|utf-7|
|65001|utf-8|
</details>

- [コードページ番号 一覧](https://learn.microsoft.com/ja-jp/windows/win32/intl/code-page-identifiers)
<br>

## 参考文献
- [Windowsでレジストリの追加or更新をコマンド（bat）で実行](https://qiita.com/waokitsune/items/e2c514530380564239b6)
- [レジストリの変更をコマンドで実行する方法](https://oozappase.com/windows/regcommand/)
- [バッチファイルによく出てくる@echo offの意味](https://qiita.com/Sanada-code/items/5d21d885b732e6fb0d03)
